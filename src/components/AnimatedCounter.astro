---
// Animated counter component for donation tracking
// Shows incremental donations with subtle animation
---

<div
  data-target="225000"
  data-prefix="$"
  class="animated-counter text-4xl md:text-5xl font-bold text-blue-600"
>
  $225,000
</div>

<style>
  @keyframes countUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animated-counter {
    animation: countUp 1s ease-out forwards;
  }

  @media (prefers-reduced-motion: reduce) {
    .animated-counter {
      animation: none !important;
    }
  }
</style>

<script>
  (function() {
    class AnimatedCounter extends HTMLElement {
      constructor() {
        super();
        this.target = 225000;
        this.observer = null;
        this.hasAnimated = false;
      }

      connectedCallback() {
        this.textContent = '$0';
        this.observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting && !this.hasAnimated) {
              this.animateCounter();
              this.hasAnimated = true;
              this.observer.unobserve(this);
            }
          });
        }, { threshold: 0.5 });
        this.observer.observe(this);
      }

      disconnectedCallback() {
        if (this.observer) {
          this.observer.disconnect();
        }
      }

      animateCounter() {
        const duration = 1500;
        const startTime = performance.now();
        const startValue = 0;
        const endValue = this.target;

        const animate = (currentTime) => {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easeOutExpo = 1 - Math.pow(2, -10 * progress);
          const current = Math.floor(startValue + (endValue - startValue) * easeOutExpo);
          this.textContent = '$' + current.toLocaleString();
          if (progress < 1) {
            requestAnimationFrame(animate);
          }
        };

        requestAnimationFrame(animate);
      }
    }

    customElements.define('animated-counter', AnimatedCounter);
  })();
</script>
